# å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5 åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒè¦æ±‚

- Go 1.20+
- PostgreSQL 12+
- Redis 6+ (å¯é€‰ï¼Œç”¨äºé«˜çº§åŠŸèƒ½)

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
PORT=8080

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=yourpassword
DB_NAME=api_db

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„å¯†é’¥ï¼ï¼‰
# ç”Ÿæˆæ–¹æ³•ï¼šopenssl rand -hex 32
JWT_SECRET=your_super_secret_key_change_this_in_production_min_32_chars
```

### 3. åˆ›å»ºæ•°æ®åº“

```bash
# è¿æ¥åˆ° PostgreSQL
psql -U postgres

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE api_db;

# é€€å‡º
\q
```

### 4. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### 5. å¯åŠ¨æœåŠ¡

```bash
go run main.go
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ“¦ æ­£åœ¨è¿æ¥æ•°æ®åº“...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ”„ æ‰§è¡Œæ•°æ®åº“è¿ç§»...
âœ… æ•°æ®åº“è¿ç§»å®Œæˆ
ğŸš€ æœåŠ¡å™¨å¯åŠ¨åœ¨ç«¯å£ 8080
```

---

## ğŸ“ æµ‹è¯• API

### æ–¹å¼ 1ï¼šä½¿ç”¨ curl

#### 1. æ³¨å†Œç”¨æˆ·

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·"
  }'
```

**é¢„æœŸå“åº”ï¼š**

```json
{
  "message": "æ³¨å†ŒæˆåŠŸ",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "created_at": "2024-01-01T00:00:00Z"
  }
}
```

#### 2. ç™»å½•

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

**é¢„æœŸå“åº”ï¼š**

```json
{
  "message": "ç™»å½•æˆåŠŸ",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxLCJleHAiOjE3MDQxNTAzMDB9.xxx",
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·"
  }
}
```

**ä¿å­˜è¿”å›çš„ tokenï¼**

#### 3. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€è¦è®¤è¯ï¼‰

```bash
# å°† YOUR_TOKEN_HERE æ›¿æ¢ä¸ºä¸Šä¸€æ­¥è¿”å›çš„ token
curl -X GET http://localhost:8080/api/auth/me \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**é¢„æœŸå“åº”ï¼š**

```json
{
  "user": {
    "id": 1,
    "username": "testuser",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·"
  }
}
```

#### 4. æµ‹è¯•æ—  Token è®¿é—®ï¼ˆåº”è¯¥å¤±è´¥ï¼‰

```bash
curl -X GET http://localhost:8080/api/auth/me
```

**é¢„æœŸå“åº”ï¼š**

```json
{
  "error": "æœªæä¾›è®¤è¯ token"
}
```

### æ–¹å¼ 2ï¼šä½¿ç”¨ Postman/Insomnia

#### 1. æ³¨å†Œ

- **Method**: POST
- **URL**: `http://localhost:8080/api/auth/register`
- **Headers**: `Content-Type: application/json`
- **Body** (JSON):
  ```json
  {
    "username": "testuser",
    "password": "password123",
    "email": "test@example.com",
    "nickname": "æµ‹è¯•ç”¨æˆ·"
  }
  ```

#### 2. ç™»å½•

- **Method**: POST
- **URL**: `http://localhost:8080/api/auth/login`
- **Headers**: `Content-Type: application/json`
- **Body** (JSON):
  ```json
  {
    "username": "testuser",
    "password": "password123"
  }
  ```
- **å¤åˆ¶è¿”å›çš„ token**

#### 3. è®¿é—®å—ä¿æŠ¤æ¥å£

- **Method**: GET
- **URL**: `http://localhost:8080/api/auth/me`
- **Headers**: 
  - `Content-Type: application/json`
  - `Authorization: Bearer <ä½ çš„token>`

---

## ğŸ”§ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: connection refused
```

**è§£å†³æ–¹æ³•ï¼š**
- æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š`pg_isready`
- æ£€æŸ¥ `.env` ä¸­çš„æ•°æ®åº“é…ç½®
- ç¡®ä¿æ•°æ®åº“å·²åˆ›å»ºï¼š`CREATE DATABASE api_db;`

### 2. JWT_SECRET æœªé…ç½®

**é”™è¯¯ä¿¡æ¯ï¼š**
```
{
  "error": "JWT_SECRET æœªé…ç½®"
}
```

**è§£å†³æ–¹æ³•ï¼š**
- ç¡®ä¿ `.env` æ–‡ä»¶å­˜åœ¨
- ç¡®ä¿ `JWT_SECRET` å·²è®¾ç½®
- ç”Ÿæˆæ–°å¯†é’¥ï¼š`openssl rand -hex 32`

### 3. Token éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
{
  "error": "æ— æ•ˆçš„ token: ..."
}
```

**å¯èƒ½åŸå› ï¼š**
- Token æ ¼å¼é”™è¯¯ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ `Bearer ` å‰ç¼€ï¼‰
- Token å·²è¿‡æœŸï¼ˆé‡æ–°ç™»å½•è·å–æ–° Tokenï¼‰
- `JWT_SECRET` æ”¹å˜äº†ï¼ˆé‡å¯æœåŠ¡åé‡æ–°ç™»å½•ï¼‰

### 4. ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
listen tcp :8080: bind: address already in use
```

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹å ç”¨ 8080 ç«¯å£çš„è¿›ç¨‹
lsof -i :8080

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä¿®æ”¹ .env ä¸­çš„ PORT
PORT=8081
```

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
api-postgreSQL/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ db.go                      # æ•°æ®åº“é…ç½®å’Œè¿æ¥
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ auth_handlers.go           # è®¤è¯ç›¸å…³å¤„ç†å™¨
â”‚   â””â”€â”€ contact_handlers.go        # ä¸šåŠ¡å¤„ç†å™¨
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth_middleware.go         # JWT è®¤è¯ä¸­é—´ä»¶
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.go                    # ç”¨æˆ·æ¨¡å‹
â”‚   â””â”€â”€ contact.go                 # ä¸šåŠ¡æ¨¡å‹
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ routes.go                  # è·¯ç”±æ€»å…¥å£
â”‚   â”œâ”€â”€ auth_routes.go             # è®¤è¯è·¯ç”±
â”‚   â””â”€â”€ contact_routes.go          # ä¸šåŠ¡è·¯ç”±
â”œâ”€â”€ secret/
â”‚   â””â”€â”€ secret_key.go              # å¯†é’¥ç”Ÿæˆå·¥å…·
â”œâ”€â”€ util/
â”‚   â”œâ”€â”€ jwt_util.go                # JWT å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ password_util.go           # å¯†ç åŠ å¯†å·¥å…·
â”‚   â””â”€â”€ contact_util.go            # ä¸šåŠ¡å·¥å…·å‡½æ•°
â”œâ”€â”€ .env                           # ç¯å¢ƒå˜é‡ï¼ˆä¸è¦æäº¤åˆ° gitï¼‰
â”œâ”€â”€ go.mod                         # Go ä¾èµ–ç®¡ç†
â”œâ”€â”€ go.sum                         # ä¾èµ–æ ¡éªŒå’Œ
â”œâ”€â”€ main.go                        # ç¨‹åºå…¥å£
â”œâ”€â”€ JWT_AUTH_GUIDE.md              # å®Œæ•´çš„è®¤è¯ç³»ç»ŸæŒ‡å—
â”œâ”€â”€ USAGE_EXAMPLE.md               # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ å®ç°æ€è·¯æ€»ç»“.md                # å®ç°æ€è·¯å’Œåº•å±‚é€»è¾‘
â””â”€â”€ å¿«é€Ÿå¼€å§‹.md                    # æœ¬æ–‡ä»¶
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### 1. ä¿æŠ¤ä½ çš„ä¸šåŠ¡æ¥å£

ä¿®æ”¹ `routes/contact_routes.go`ï¼š

```go
func ContactRoutes(router *gin.RouterGroup) {
  // æ·»åŠ è®¤è¯ä¸­é—´ä»¶
  contacts := router.Group("/contacts")
  contacts.Use(middleware.AuthMiddleware())
  {
    contacts.GET("", handlers.GetAllContacts)
    contacts.POST("", handlers.CreateContact)
    contacts.PUT("/:id", handlers.UpdateContact)
    contacts.DELETE("/:id", handlers.DeleteContact)
  }
}
```

### 2. åœ¨ Handler ä¸­è·å–å½“å‰ç”¨æˆ·

ä¿®æ”¹ `handlers/contact_handlers.go`ï¼š

```go
func CreateContact(c *gin.Context) {
  // è·å–å½“å‰ç™»å½•ç”¨æˆ·
  userID, exists := middleware.GetCurrentUserID(c)
  if !exists {
    c.JSON(401, gin.H{"error": "æœªè®¤è¯"})
    return
  }

  // ä½¿ç”¨ userID è¿›è¡Œä¸šåŠ¡é€»è¾‘
  fmt.Printf("ç”¨æˆ· %d æ­£åœ¨åˆ›å»ºè”ç³»äºº\n", userID)
  
  // ... ä½ çš„ä¸šåŠ¡é€»è¾‘ ...
}
```

### 3. é›†æˆ Redisï¼ˆå¯é€‰ï¼‰

æŸ¥çœ‹ `JWT_AUTH_GUIDE.md` ä¸­çš„ Redis é›†æˆç« èŠ‚ã€‚

### 4. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

- ä½¿ç”¨ HTTPSï¼ˆå¿…é¡»ï¼ï¼‰
- ä¿®æ”¹ `JWT_SECRET` ä¸ºå¼ºéšæœºå¯†é’¥
- è®¾ç½®åˆç†çš„ Token è¿‡æœŸæ—¶é—´
- é…ç½® CORS
- æ·»åŠ æ—¥å¿—è®°å½•
- æ·»åŠ é™æµä¿æŠ¤

---

## ğŸ“– å®Œæ•´æ–‡æ¡£

- **JWT_AUTH_GUIDE.md**: å®Œæ•´çš„è®¤è¯ç³»ç»Ÿä½¿ç”¨æŒ‡å—
- **å®ç°æ€è·¯æ€»ç»“.md**: åº•å±‚åŸç†å’Œå®ç°æ€è·¯è¯¦è§£
- **USAGE_EXAMPLE.md**: å®é™…ä½¿ç”¨ç¤ºä¾‹å’Œä»£ç ç‰‡æ®µ

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

### API ç«¯ç‚¹æ€»è§ˆ

| æ–¹æ³• | è·¯å¾„ | éœ€è¦è®¤è¯ | è¯´æ˜ |
|------|------|---------|------|
| POST | `/api/auth/register` | âŒ | ç”¨æˆ·æ³¨å†Œ |
| POST | `/api/auth/login` | âŒ | ç”¨æˆ·ç™»å½• |
| POST | `/api/auth/logout` | âœ… | ç”¨æˆ·ç™»å‡º |
| GET | `/api/auth/me` | âœ… | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |

### å¸¸ç”¨å‘½ä»¤

```bash
# è¿è¡ŒæœåŠ¡
go run main.go

# ç¼–è¯‘
go build -o server

# è¿è¡Œç¼–è¯‘åçš„ç¨‹åº
./server

# æ›´æ–°ä¾èµ–
go mod tidy

# æŸ¥çœ‹æ‰€æœ‰ä¾èµ–
go list -m all

# æ ¼å¼åŒ–ä»£ç 
go fmt ./...

# æ£€æŸ¥ä»£ç 
go vet ./...
```

### ç”Ÿæˆ JWT_SECRET

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ openssl
openssl rand -hex 32

# æ–¹æ³• 2ï¼šä½¿ç”¨ Go
go run -c 'package main; import ("fmt"; "crypto/rand"; "encoding/hex"); func main() { b := make([]byte, 32); rand.Read(b); fmt.Println(hex.EncodeToString(b)) }'

# æ–¹æ³• 3ï¼šåœ¨çº¿ç”Ÿæˆ
# è®¿é—®: https://www.random.org/strings/
```

---

## âœ… éªŒè¯æ¸…å•

å®‰è£…å’Œé…ç½®å®Œæˆåï¼Œç¡®ä¿ï¼š

- [ ] PostgreSQL æ­£åœ¨è¿è¡Œ
- [ ] æ•°æ®åº“å·²åˆ›å»º
- [ ] `.env` æ–‡ä»¶å·²é…ç½®
- [ ] `JWT_SECRET` å·²è®¾ç½®ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
- [ ] ä¾èµ–å·²å®‰è£… (`go mod tidy`)
- [ ] æœåŠ¡æˆåŠŸå¯åŠ¨
- [ ] æ³¨å†Œæ¥å£æ­£å¸¸å·¥ä½œ
- [ ] ç™»å½•æ¥å£è¿”å› Token
- [ ] å—ä¿æŠ¤æ¥å£éªŒè¯ Token

---

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£ï¼š
- `JWT_AUTH_GUIDE.md` - å®Œæ•´æŒ‡å—
- `å®ç°æ€è·¯æ€»ç»“.md` - åº•å±‚åŸç†
- `USAGE_EXAMPLE.md` - ä»£ç ç¤ºä¾‹

